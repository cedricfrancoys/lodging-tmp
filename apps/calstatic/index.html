<!DOCTYPE html>
<html lang="fr-FR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.css" />

<link rel="stylesheet" type="text/css" href="assets/css/datepickk.css" />
<link rel="stylesheet" type="text/css" href="assets/css/section_styles.css" />
<link rel="stylesheet" type="text/css" href="assets/css/calendar_styles.css" />

<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-migrate/3.1.0/jquery-migrate.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/locale/fr.js"></script>

<script type="text/javascript" src="assets/js/datepickk.js"></script>

<script>
var map_slugs = {
    "arbrefontaine-ecole":3,
    "arbrefontaine-la-ruche"      : 4,
    "arbrefontaine-petite-maison" : 4,
    "basseilles-1"                : 5,
    "basseilles-2"                : 5,
    "bastogne"                    : 6,
    "bohan"                       : 7,
    "bruly-presbytere"            : 8,
    "bruly-ecole"                 : 9,
    "chassepierre"                : 10,
    "cornimont"                   : 11,
    "daverdisse"                  : 12,
    "hastiere"                    : 13,
    "haus-stockem-eupen"          : 14,
    "la-reid"                     : 15,
    "latour"                      : 16,
    "lesse-redu"                  : 18,
    "maboge"                      : 19,
    "mormont-grande"              : 20,
    "mormont-petite"              : 20,
    "vergnies"                    : 21,
    "werbomont"                   : 23
};
$( document ).ready(function() {
	var center_id = 0;
    var bookings = new Array();
    var closings = new Array();
    var calendars = new Array();
    var month = 0, period = 1;
    var rental_unit_id = 0;

	var slug = 'unknown';
	var searchParams = new URLSearchParams(window.location.search);
	if(searchParams.has('slug')) {
		slug = searchParams.get('slug');
		console.log(slug);
	}

	if(map_slugs.hasOwnProperty(slug)) {
		center_id = map_slugs[slug];
        console.log(center_id);
        const slugsToRentalUnitIds = {
            'arbrefontaine-la-ruche': 903,
            'arbrefontaine-petite-maison': 902,
            'basseilles-1': 905,
            'basseilles-2': 906
        };
        if (slugsToRentalUnitIds.hasOwnProperty(slug)) {
            rental_unit_id = slugsToRentalUnitIds[slug];
        }
	}

	if(center_id <= 0) {
	console.log('no slug match');
		return;
	}
	$.get("/?get=lodging_consumption_map-public&centers_ids[]="+center_id+ "&rental_unit_id="+  rental_unit_id, function( bookings ) {
        // check selection against existing bookings
		bookings.forEach(function(booking) {
            booking.class = '';
            if (booking.type_consumption == "ooo") {
                booking.class = 'repairing';
            }else if (booking.type_consumption == "part") {
                booking.class = 'partial';
            }else {
                booking.class = 'booked';
            }

			booking.start = new Date(booking.date_from);
			booking.end = new Date(booking.date_to);
			booking.end.setDate(booking.end.getDate() - 1);
			bookings.push(booking);
		});


		var current_year = (new Date()).getFullYear();
		var calendar_config = {
			from: {
				year: current_year,
				month: 0
			},
			to: {
				year: current_year+2,
				month: 11
			}
		};

		/*
		config.rates.forEach(function(rate) {

			rate.start = new Date(rate.start);
			rate.end = new Date(rate.end);
			if(rate.rate == -1) {
				for (var d = rate.start; d <= rate.end; d.setDate(d.getDate() + 1)) {
					closings.push(new Date(d));
				}
			}
		});
		*/

		$template = $("#template-calendar").children();
		var max = calendar_config.to.year * 100 + calendar_config.to.month;
		var i = 0;
		while(true) {
			var date = new Date(calendar_config.from.year,calendar_config.from.month + i, 1);

			if(date.getFullYear()*100 + date.getMonth() > max) {
				console.log('break', date);
				break;
			}

			$calendar = $template.clone();
			$('[data-item=\''+date.getFullYear()+'\']').find('.calendars-wrapper').append($calendar);
			var $tab = $('#tab_header').find('[data-option=\''+date.getFullYear()+'\']');
			$tab.show();
			$tab.addClass('visible');

			$calendar.find('.datepickk').each(function() {
				var date_str = $(this).attr('date');
				var calendar = new Datepickk({
					lang: 'fr',
					container: this,
					inline:true,
					daynames: false,
					locked: true,
					startDate: new Date(calendar_config.from.year,calendar_config.from.month + i, 1),
					disabledDates: closings,
					highlight: bookings
				});
				// update increment
				++i;
			});

		}

		// set locale based on current location
		moment.locale('fr');


		/*
		 * add dynamic capabilities
		 */

		// tabs
		$('#tab_header ul li.item').on('click', function() {
			var number = $(this).data('option');
			$('#tab_header ul li.item').removeClass('is-active');
			$(this).addClass('is-active');
			$('#tab_container .container_item').removeClass('is-active');
			$('div[data-item="' + number + '"]').addClass('is-active');
		});


		$('#tab_header ul li.item.visible').first().trigger('click');


	});


});
</script>
<style>
#tab_header li {
	display: none;
}
</style>
</head>

<body class="page-template page-template-template-hero page-template-template-hero-php page page-id-597 group-blog is-hero is-hamburger-left is-logo-centered is-logo-image is-block-frame accent-is-brown is-lightbox-enabled is-block-animation">

    <div id="template-calendar" style="display: none;">
        <div class="columns">
            <div class="column is-4 "><div class="datepickk"></div></div>
            <div class="column is-4 "><div class="datepickk"></div></div>
            <div class="column is-4 "><div class="datepickk"></div></div>
        </div>
    </div>

    <div id="page" class="site">

        <div id="content" class="site-content">

            <div class="container ">
                <div class="tabs" id="tab_header">
                  <ul>
                    <!-- <li class="item is-active" data-option="2019"><a>2019</a></li> -->
                    <!-- <li class="item is-active" data-option="2020"><a>2020</a></li> -->
                    <!-- <li class="item is-active" data-option="2021"><a>2021</a></li> -->
                    <li class="item" data-option="2022"><a>2022</a></li>
                    <li class="item" data-option="2023"><a>2023</a></li>
                    <li class="item" data-option="2024"><a>2024</a></li>
                    <li class="item" data-option="2025"><a>2025</a></li>
                    <li class="item" data-option="2026"><a>2026</a></li>
                    <li class="item" data-option="2027"><a>2027</a></li>
                  </ul>
                </div>
            </div>
            <div id="tab_container" class="container">

                <div class="container_item is-active" data-item="2022">
                    <div class="columns is-desktop">
                        <div class="column is-9-desktop calendars-wrapper"></div>
                    </div>
                </div>

				<div class="container_item" data-item="2023">
                    <div class="columns is-desktop">
                        <div class="column is-9-desktop calendars-wrapper"></div>
                    </div>
                </div>

				<div class="container_item" data-item="2024">
                    <div class="columns is-desktop">
                        <div class="column is-9-desktop calendars-wrapper"></div>
                    </div>
                </div>


				<div class="container_item" data-item="2025">
                    <div class="columns is-desktop">
                        <div class="column is-9-desktop calendars-wrapper"></div>
                    </div>
                </div>


				<div class="container_item" data-item="2026">
                    <div class="columns is-desktop">
                        <div class="column is-9-desktop calendars-wrapper"></div>
                    </div>
                </div>

				<div class="container_item" data-item="2027">
                    <div class="columns is-desktop">
                        <div class="column is-9-desktop calendars-wrapper"></div>
                    </div>
                </div>

            </div>

        </div>

    </div>

</body>
</html>